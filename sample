using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Provide the file paths
        string filePath1 = "path_to_file1.xlsx";
        string filePath2 = "path_to_file2.xlsx";

        // Open Excel application
        Excel.Application excelApp = new Excel.Application();
        excelApp.Visible = true;

        // Open workbooks
        Excel.Workbook workbook1 = excelApp.Workbooks.Open(filePath1);
        Excel.Workbook workbook2 = excelApp.Workbooks.Open(filePath2);

        // Get the first worksheet from each workbook
        Excel.Worksheet worksheet1 = workbook1.Sheets[1];
        Excel.Worksheet worksheet2 = workbook2.Sheets[1];

        // Find the last columns in each worksheet
        int lastColumn1 = worksheet1.Cells[1, worksheet1.Columns.Count].End[Excel.XlDirection.xlToLeft].Column;
        int lastColumn2 = worksheet2.Cells[1, worksheet2.Columns.Count].End[Excel.XlDirection.xlToLeft].Column;

        // Add new columns for the results in the first workbook
        int resultStartColumn = lastColumn1 + 2; // Adjust as needed
        int resultEndColumn = resultStartColumn + lastColumn2 - 1; // Adjust as needed

        for (int col = resultStartColumn; col <= resultEndColumn; col++)
        {
            Excel.Range resultColumn = worksheet1.Cells[1, col];
            resultColumn.Value = "Result_" + (col - resultStartColumn + 1);
        }

        // Compare each column and update the result columns
        for (int col = 1; col <= lastColumn1; col++)
        {
            for (int col2 = 1; col2 <= lastColumn2; col2++)
            {
                // Assuming headers are in the first row, adjust the row index if headers are elsewhere
                string header1 = worksheet1.Cells[1, col].Value.ToString();
                string header2 = worksheet2.Cells[1, col2].Value.ToString();

                if (header1 == header2)
                {
                    // Compare data in the current column
                    for (int row = 2; row <= worksheet1.Rows.Count; row++)
                    {
                        string value1 = worksheet1.Cells[row, col].Value.ToString();
                        string value2 = worksheet2.Cells[row, col2].Value.ToString();

                        // Update the result column accordingly
                        worksheet1.Cells[row, resultStartColumn + col2 - 1].Value = (value1 == value2) ? "Match" : "No Match";
                    }
                }
            }
        }

        // Save and close workbooks
        workbook1.Save();
        workbook1.Close();
        workbook2.Close();

        // Quit Excel application
        excelApp.Quit();
    }
}
