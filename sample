using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Provide the file paths
        string filePath1 = "path_to_file1.xlsx";
        string filePath2 = "path_to_file2.xlsx";

        // Open Excel application
        Excel.Application excelApp = new Excel.Application();
        excelApp.Visible = true;

        // Open workbooks
        Excel.Workbook workbook1 = excelApp.Workbooks.Open(filePath1);
        Excel.Workbook workbook2 = excelApp.Workbooks.Open(filePath2);

        // Get the first worksheet from each workbook
        Excel.Worksheet worksheet1 = workbook1.Sheets[1];
        Excel.Worksheet worksheet2 = workbook2.Sheets[1];

        // Find the last columns in each worksheet
        int lastColumn1 = worksheet1.Cells[1, worksheet1.Columns.Count].End[Excel.XlDirection.xlToLeft].Column;
        int lastColumn2 = worksheet2.Cells[1, worksheet2.Columns.Count].End[Excel.XlDirection.xlToLeft].Column;

        // Add a new column for the result in the first workbook
        int resultStartColumn = lastColumn1 + 2; // Adjust as needed
        Excel.Range resultColumn = worksheet1.Cells[1, resultStartColumn];
        resultColumn.Value = "Result";

        // Compare each column and update the result column
        for (int col1 = 1; col1 <= lastColumn1; col1++)
        {
            string header1 = worksheet1.Cells[1, col1].Value.ToString();

            for (int col2 = 1; col2 <= lastColumn2; col2++)
            {
                string header2 = worksheet2.Cells[1, col2].Value.ToString();

                if (header1 == header2)
                {
                    // Compare data in the current column
                    for (int row = 2; row <= worksheet1.Rows.Count; row++)
                    {
                        string value1 = worksheet1.Cells[row, col1].Value.ToString();
                        string value2 = worksheet2.Cells[row, col2].Value.ToString();

                        // Update the result column accordingly
                        worksheet1.Cells[row, resultStartColumn].Value = (value1 == value2) ? "Match" : "No Match";
                    }
                    break;
                }
            }
        }

        // Save and close workbooks
        workbook1.Save();
        workbook1.Close();
        workbook2.Close();

        // Quit Excel application
        excelApp.Quit();
    }
}
