using System;
using System.Data;
using System.Linq;

class Program
{
    static void Main()
    {
        // Sample source DataTable
        DataTable sourceDataTable = new DataTable();
        sourceDataTable.Columns.Add("ID", typeof(int));
        sourceDataTable.Columns.Add("Name", typeof(string));
        sourceDataTable.Rows.Add(1, "John");
        sourceDataTable.Rows.Add(2, "Jane");
        sourceDataTable.Rows.Add(3, "Doe");

        // Sample target DataTable with differences
        DataTable targetDataTable = new DataTable();
        targetDataTable.Columns.Add("ID", typeof(int));
        targetDataTable.Columns.Add("Name", typeof(string));
        targetDataTable.Rows.Add(1, "John");
        targetDataTable.Rows.Add(2, "JaneUpdated"); // Difference
        targetDataTable.Rows.Add(4, "NewPerson");   // Difference

        // Add a column to mark differences in the source DataTable
        sourceDataTable.Columns.Add("IsDifferent", typeof(bool));

        // Use LINQ to compare and mark differences
        var differences = from sourceRow in sourceDataTable.AsEnumerable()
                          join targetRow in targetDataTable.AsEnumerable()
                          on sourceRow.Field<int>("ID") equals targetRow.Field<int>("ID") into joined
                          from targetRow in joined.DefaultIfEmpty()
                          select new
                          {
                              ID = sourceRow.Field<int>("ID"),
                              Name = sourceRow.Field<string>("Name"),
                              IsDifferent = targetRow == null || !sourceRow["Name"].Equals(targetRow["Name"])
                          };

        // Update the IsDifferent column in the source DataTable
        foreach (var diff in differences)
        {
            DataRow sourceRow = sourceDataTable.AsEnumerable()
                .Single(row => row.Field<int>("ID") == diff.ID);
            sourceRow.SetField("IsDifferent", diff.IsDifferent);
        }

        // Display the result
        foreach (DataRow row in sourceDataTable.Rows)
        {
            Console.WriteLine($"ID: {row["ID"]}, Name: {row["Name"]}, IsDifferent: {row["IsDifferent"]}");
        }
    }
}
