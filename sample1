using System;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main(string[] args)
    {
        string filePath = @"C:\path\to\your\file.xlsx";
        string sheetName = "Sheet1"; // Adjust the sheet name as necessary

        Excel.Application excelApp = new Excel.Application();
        Excel.Workbook workbook = null;
        Excel.Worksheet worksheet = null;

        try
        {
            // Open the workbook
            workbook = excelApp.Workbooks.Open(filePath);
            worksheet = workbook.Sheets[sheetName] as Excel.Worksheet;

            if (worksheet != null)
            {
                // Insert two new columns before column A
                Excel.Range columnA = worksheet.Columns["A"];
                columnA.Insert(Excel.XlInsertShiftDirection.xlShiftToRight);
                columnA.Insert(Excel.XlInsertShiftDirection.xlShiftToRight);

                // Find the last used row in the worksheet
                int lastRow = worksheet.Cells[worksheet.Rows.Count, "C"].End(Excel.XlDirection.xlUp).Row;

                // Populate the new column A with a formula
                Excel.Range newColumnA = worksheet.Range["A1", $"A{lastRow}"];
                newColumnA.Formula = "=C1"; // Example formula, adjust as needed

                // Populate the new column B with a different formula
                Excel.Range newColumnB = worksheet.Range["B1", $"B{lastRow}"];
                newColumnB.Formula = "=D1"; // Example formula, adjust as needed

                // Save the workbook
                workbook.Save();
                Console.WriteLine("Two new columns added and formulas set successfully.");
            }
            else
            {
                Console.WriteLine("Sheet not found.");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine($"An error occurred: {ex.Message}");
        }
        finally
        {
            // Clean up
            if (workbook != null)
            {
                workbook.Close(false);
                Marshal.ReleaseComObject(workbook);
            }
            excelApp.Quit();
            Marshal.ReleaseComObject(excelApp);
        }
    }
}
