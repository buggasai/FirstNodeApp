using System;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Create a new Excel application
        Excel.Application excelApp = new Excel.Application();
        
        // Make the application visible
        excelApp.Visible = true;

        // Add a new workbook
        Excel.Workbook workbook = excelApp.Workbooks.Add();
        
        // Get the active sheet
        Excel.Worksheet worksheet = (Excel.Worksheet)workbook.ActiveSheet;

        // Define the formula
        string formula = @"=IFNA(VLOOKUP(A4,'edlohn kunden'!A:H,8,0),""Keine Angabe"")";

        // Specify the range where you want to insert the formula
        Excel.Range startCell = worksheet.Cells[4, 6]; // Cell F4
        Excel.Range endCell = worksheet.Cells[worksheet.Rows.Count, 6]; // Cell F to the last row

        // Fill the range with the formula
        Excel.Range fillRange = worksheet.Range[startCell, endCell];
        fillRange.Formula = formula;

        // Optional: AutoFit the column width
        worksheet.Columns["F"].AutoFit();

        // Clean up
        GC.Collect();
        GC.WaitForPendingFinalizers();
        Marshal.ReleaseComObject(fillRange);
        Marshal.ReleaseComObject(startCell);
        Marshal.ReleaseComObject(endCell);
        Marshal.ReleaseComObject(worksheet);
        workbook.Close(false);
        Marshal.ReleaseComObject(workbook);
        excelApp.Quit();
        Marshal.ReleaseComObject(excelApp);
    }
}
