using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Create a new instance of Excel application
        Excel.Application excelApp = new Excel.Application();

        // Open the workbook (replace with the path to your Excel file)
        Excel.Workbook workbook = excelApp.Workbooks.Open(@"C:\Path\To\Your\Workbook.xlsx");

        try
        {
            // Assuming your data starts from row 8 and you want to apply filter on column A to Z
            Excel.Worksheet worksheet = workbook.Worksheets["Sheet1"];

            // Find the last row with data in column A (assuming data starts from column A)
            int lastRow = worksheet.Cells.SpecialCells(Excel.XlCellType.xlCellTypeLastCell).Row;

            // Define the range from row 8 to the last row and apply filter
            Excel.Range range = worksheet.Range["A8:Z" + lastRow];
            range.AutoFilter();

            Console.WriteLine("Filter applied successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error applying filter: " + ex.Message);
        }
        finally
        {
            // Save the workbook
            workbook.Save();

            // Close the workbook and Excel application
            workbook.Close();
            excelApp.Quit();

            // Release COM objects to avoid memory leaks
            ReleaseObject(worksheet);
            ReleaseObject(workbook);
            ReleaseObject(excelApp);
        }
    }

    // Helper method to release COM objects
    private static void ReleaseObject(object obj)
    {
        try
        {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
            obj = null;
        }
        catch (System.Exception ex)
        {
            obj = null;
            Console.WriteLine("Exception Occured while releasing object " + ex.ToString());
        }
        finally
        {
            GC.Collect();
        }
    }
}
