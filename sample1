using System;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Excel.Application excelApp = null;
        Excel.Workbook workbook = null;

        try
        {
            // Start Excel application
            excelApp = new Excel.Application();
            
            // Make Excel visible (optional)
            excelApp.Visible = true; // Set to true for debugging, set to false for production

            // Path to the Excel file
            string filePath = @"C:\path\to\your\excel_file.xlsx";

            // Open the Excel file
            workbook = excelApp.Workbooks.Open(filePath);
            Excel.Worksheet worksheet = workbook.Sheets[1]; // Assumes the first worksheet

            // Add the formula to cell H2
            Excel.Range cellH2 = worksheet.Cells[2, 8]; // H2 is represented as (2, 8) in Excel interop (G is 7th column, H is 8th column)
            cellH2.Formula = "=IF(G2=\"BOB\",\"HI\",IF(G2=\"SL\",\"He\",\"She\"))";

            // Save and close the workbook
            workbook.Save();
            workbook.Close();

            Console.WriteLine("Formula added successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("An error occurred: " + ex.Message);
        }
        finally
        {
            // Quit Excel application
            if (excelApp != null)
            {
                excelApp.Quit();
                System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);
            }
        }
    }
}
