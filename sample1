using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Create a new instance of Excel application
        Excel.Application excelApp = new Excel.Application();

        // Open the workbook (replace with the path to your Excel file)
        Excel.Workbook workbook = excelApp.Workbooks.Open(@"C:\Path\To\Your\Workbook.xlsx");

        try
        {
            // Assuming your data starts from row 8 and you want to sort column B
            Excel.Worksheet worksheet = workbook.Worksheets["Sheet1"];

            // Define the range where the filter is applied (starting from row 8)
            Excel.Range filteredRange = worksheet.Range["A8:Z" + worksheet.Rows.Count];

            // Apply sort to column B within the filtered range, smallest to largest
            Excel.Range sortRange = filteredRange.Columns["B:B"];
            sortRange.Sort(sortRange, Excel.XlSortOrder.xlAscending,
                           Header: Excel.XlYesNoGuess.xlNo, OrderCustom: 1, MatchCase: false,
                           Orientation: Excel.XlSortOrientation.xlSortColumns);

            Console.WriteLine("Column B sorted smallest to largest within the filtered range.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error sorting column B within the filtered range: " + ex.Message);
        }
        finally
        {
            // Save the workbook
            workbook.Save();

            // Close the workbook and Excel application
            workbook.Close();
            excelApp.Quit();

            // Release COM objects to avoid memory leaks
            ReleaseObject(worksheet);
            ReleaseObject(workbook);
            ReleaseObject(excelApp);
        }
    }

    // Helper method to release COM objects
    private static void ReleaseObject(object obj)
    {
        try
        {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
            obj = null;
        }
        catch (System.Exception ex)
        {
            obj = null;
            Console.WriteLine("Exception Occured while releasing object " + ex.ToString());
        }
        finally
        {
            GC.Collect();
        }
    }
}
