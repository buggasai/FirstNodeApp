using Excel = Microsoft.Office.Interop.Excel;

class ExcelInteropExample
{
    public void CopyDataExcludingPivotTables(string sourceFilePath, string sourceSheetName, string targetSheetName)
    {
        Excel.Application excelApp = new Excel.Application();
        Excel.Workbook workbook = excelApp.Workbooks.Open(sourceFilePath);
        Excel.Worksheet sourceSheet = workbook.Sheets[sourceSheetName];
        Excel.Worksheet targetSheet = workbook.Sheets[targetSheetName];

        try
        {
            // Find the used range excluding pivot tables
            Excel.Range usedRange = sourceSheet.UsedRange.SpecialCells(Excel.XlCellType.xlCellTypeVisible);

            // Clear existing data in destination range A1:Gx (where x is the last row in used range)
            Excel.Range targetRange = targetSheet.Range["A1:G" + usedRange.Rows.Count];
            targetRange.ClearContents();

            // Copy values excluding pivot tables
            if (usedRange != null)
            {
                targetRange.Value = usedRange.Value;
            }

            // Save and close workbook
            workbook.Save();
            workbook.Close();
        }
        finally
        {
            // Clean up Excel objects
            ReleaseObject(sourceSheet);
            ReleaseObject(targetSheet);
            ReleaseObject(workbook);
            ReleaseObject(excelApp);
        }
    }

    private void ReleaseObject(object obj)
    {
        try
        {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
            obj = null;
        }
        catch (System.Exception ex)
        {
            obj = null;
            Console.WriteLine("Exception occurred while releasing object " + ex.ToString());
        }
        finally
        {
            GC.Collect();
        }
    }
}
