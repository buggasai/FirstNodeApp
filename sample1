using System;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Excel.Application excelApp = null;
        Excel.Workbook sourceWorkbook = null;
        Excel.Workbook destinationWorkbook = null;

        try
        {
            // Initialize the Excel application
            excelApp = new Excel.Application();
            excelApp.Visible = false; // Set to true for debugging, false for production

            // Define file paths
            string sourceFilePath = @"C:\path\to\your\source_excel_file.xlsx";
            string destinationFilePath = @"C:\path\to\your\destination_excel_file.xlsx";

            // Open the source workbook
            sourceWorkbook = excelApp.Workbooks.Open(sourceFilePath);
            Excel.Worksheet sourceWorksheet = sourceWorkbook.Sheets[1]; // Assuming the first worksheet

            // Get the used range of the source worksheet
            Excel.Range usedRange = sourceWorksheet.UsedRange;
            object[,] fullData = usedRange.Value2;

            // Get dimensions excluding the header row
            int numRows = fullData.GetLength(0) - 1;
            int numCols = fullData.GetLength(1);

            // Create a new array to hold data excluding the header row
            object[,] data = new object[numRows, numCols];

            // Efficiently copy data from the source array excluding the header row
            Array.Copy(fullData, numCols, data, 0, numRows * numCols);

            // Close the source workbook without saving changes
            sourceWorkbook.Close(false);

            // Open the destination workbook
            destinationWorkbook = excelApp.Workbooks.Open(destinationFilePath);
            Excel.Worksheet destinationWorksheet = destinationWorkbook.Sheets[1]; // Assuming the first worksheet

            // Define the starting cell for pasting values (A9)
            int startPasteRow = 9;
            int startPasteCol = 1;

            // Define the destination range and paste values
            Excel.Range destinationRange = destinationWorksheet.Cells[startPasteRow, startPasteCol];
            destinationRange.Resize[numRows, numCols].Value2 = data;

            // Save and close the destination workbook
            destinationWorkbook.Save();
            destinationWorkbook.Close();

            Console.WriteLine("Data copied and pasted successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("An error occurred: " + ex.Message);
        }
        finally
        {
            // Quit the Excel application
            if (excelApp != null)
            {
                excelApp.Quit();
                System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);
            }
        }
    }
}
