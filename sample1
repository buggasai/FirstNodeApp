using System;
using System.Runtime.InteropServices;
using Microsoft.Office.Interop.Excel;

namespace ExcelManipulation
{
    class Program
    {
        static void Main(string[] args)
        {
            Application excelApp = null;
            Workbook workbook = null;
            Worksheet worksheet = null;

            try
            {
                excelApp = new Application();
                workbook = excelApp.Workbooks.Open(@"C:\path\to\your\file.xlsx");
                worksheet = (Worksheet)workbook.Sheets[1];

                // Insert a column after column A
                Range columnB = worksheet.Columns["B"];
                columnB.Insert(XlInsertShiftDirection.xlShiftToRight);

                // Insert a column after column D
                Range columnE = worksheet.Columns["E"];
                columnE.Insert(XlInsertShiftDirection.xlShiftToRight);

                // Split data in column A and place in the new column B
                Range columnA = worksheet.Columns["A"];
                Range newColumnB = worksheet.Columns["B"];
                for (int i = 1; i <= columnA.Rows.Count; i++)
                {
                    Range cellA = columnA.Cells[i, 1] as Range;
                    if (cellA != null && cellA.Value2 != null)
                    {
                        string cellValue = cellA.Value2.ToString();
                        string[] parts = cellValue.Split('/');
                        if (parts.Length > 1)
                        {
                            newColumnB.Cells[i, 1].Value2 = parts[1];
                            cellA.Value2 = parts[0];
                        }
                    }
                }

                // Extract the time part from column D and place in the new column E
                Range columnD = worksheet.Columns["D"];
                Range newColumnE = worksheet.Columns["E"];
                for (int i = 1; i <= columnD.Rows.Count; i++)
                {
                    Range cellD = columnD.Cells[i, 1] as Range;
                    if (cellD != null && cellD.Value2 != null)
                    {
                        string cellValue = cellD.Value2.ToString();
                        if (DateTime.TryParse(cellValue, out DateTime dateTime))
                        {
                            newColumnE.Cells[i, 1].Value2 = dateTime.ToString("HH:mm:ss");
                            cellD.Value2 = dateTime.ToString("yyyy-MM-dd");
                        }
                    }
                }

                workbook.Save();
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error: {ex.Message}");
            }
            finally
            {
                if (workbook != null)
                {
                    workbook.Close(false);
                    Marshal.ReleaseComObject(workbook);
                }
                if (excelApp != null)
                {
                    excelApp.Quit();
                    Marshal.ReleaseComObject(excelApp);
                }

                // Ensure to release COM objects
                GC.Collect();
                GC.WaitForPendingFinalizers();
            }
        }
    }
}
