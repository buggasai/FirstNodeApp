using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Initialize Excel application
        Excel.Application excelApp = new Excel.Application();
        excelApp.Visible = true; // Make Excel visible (for demonstration purposes)

        // Open an existing workbook
        string workbookPath = @"C:\Path\To\Your\Workbook.xlsx";
        Excel.Workbook workbook = excelApp.Workbooks.Open(workbookPath);

        // Get the desired worksheet (e.g., first worksheet)
        Excel.Worksheet worksheet = (Excel.Worksheet)workbook.Sheets[1]; // Assuming it's the first sheet

        try
        {
            // Shift existing rows down to make space for the new row
            Excel.Range firstRow = worksheet.Rows[1];
            firstRow.Insert(Excel.XlInsertShiftDirection.xlShiftDown);

            // Insert data into the new first row
            worksheet.Cells[1, 1].Value = "New Data 1"; // Insert data into first column
            worksheet.Cells[1, 2].Value = "New Data 2"; // Insert data into second column
            worksheet.Cells[1, 3].Value = "New Data 3"; // Insert data into third column

            Console.WriteLine("New row inserted at the first row successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error: " + ex.Message);
        }
        finally
        {
            // Save and close the workbook
            workbook.Save(); // Save changes
            workbook.Close(); // Close workbook
            excelApp.Quit(); // Quit Excel application

            // Release COM objects to properly clean up Excel resources
            ReleaseObject(worksheet);
            ReleaseObject(workbook);
            ReleaseObject(excelApp);
        }
    }

    // Helper method to release COM objects
    static void ReleaseObject(object obj)
    {
        try
        {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
            obj = null;
        }
        catch (Exception ex)
        {
            obj = null;
            Console.WriteLine("Error releasing COM object: " + ex.Message);
        }
        finally
        {
            GC.Collect(); // Force garbage collection
        }
    }
}
