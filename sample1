using System;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Create a new Excel application
        Excel.Application excelApp = new Excel.Application();

        // Make the application visible (optional for demonstration)
        excelApp.Visible = true;

        // Define the path to the workbook
        string filePath = @"C:\path\to\your\file.xlsx";

        // Open the workbook
        Excel.Workbook workbook = excelApp.Workbooks.Open(filePath);

        // Define the worksheet name
        string worksheetName = "Sheet1"; // Replace with your worksheet name

        try
        {
            // Access the worksheet
            Excel.Worksheet worksheet = (Excel.Worksheet)workbook.Sheets[worksheetName];

            // Get the used range of the worksheet
            Excel.Range usedRange = worksheet.UsedRange;

            // Define the sort range starting from row 8 downwards
            Excel.Range sortRange = worksheet.Range["A8", usedRange.Cells[usedRange.Rows.Count, usedRange.Columns.Count]];

            // Sort the range by multiple columns
            sortRange.Sort(
                Key1: worksheet.Range["B8"],
                Order1: Excel.XlSortOrder.xlAscending,
                Key2: worksheet.Range["H8"],
                Order2: Excel.XlSortOrder.xlAscending,
                Key3: worksheet.Range["E8"],
                Order3: Excel.XlSortOrder.xlAscending,
                Header: Excel.XlYesNoGuess.xlYes,
                OrderCustom: 1,
                MatchCase: false,
                Orientation: Excel.XlSortOrientation.xlSortRows,
                SortMethod: Excel.XlSortMethod.xlPinYin,
                DataOption1: Excel.XlSortDataOption.xlSortNormal,
                DataOption2: Excel.XlSortDataOption.xlSortNormal,
                DataOption3: Excel.XlSortDataOption.xlSortNormal
            );

            Console.WriteLine("Range sorted successfully.");

            // Save the workbook if needed
            // workbook.Save();
        }
        catch (COMException comEx)
        {
            Console.WriteLine($"COM Error: {comEx.Message}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"General Error: {ex.Message}");
        }
        finally
        {
            // Close the workbook and quit Excel application
            workbook.Close(false);
            excelApp.Quit();

            // Clean up
            Marshal.ReleaseComObject(workbook);
            Marshal.ReleaseComObject(excelApp);

            GC.Collect();
            GC.WaitForPendingFinalizers();
        }
    }
}
