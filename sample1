using System;
using Excel = Microsoft.Office.Interop.Excel;

class ExcelInteropExample
{
    public void ProcessKundenSheet(string filePath)
    {
        // Open the Excel application
        Excel.Application excelApp = new Excel.Application();
        Excel.Workbook workbook = excelApp.Workbooks.Open(filePath);
        Excel.Worksheet kundenSheet = workbook.Sheets["kunden"];

        try
        {
            // Get the last used row in the "kunden" sheet
            int lastRow = kundenSheet.Cells[kundenSheet.Rows.Count, 1].End(Excel.XlDirection.xlUp).Row;

            // Iterate through each row and get the value from column F
            for (int row = 1; row <= lastRow; row++)
            {
                Excel.Range rowRange = kundenSheet.Rows[row];
                string rowValue = rowRange.Cells[1, 1].Text; // You can adjust the column index based on your needs
                string fColumnValue = rowRange.Cells[1, 6].Text; // Column F (6th column)

                Console.WriteLine($"Row {row}: Value = {rowValue}, Column F Value = {fColumnValue}");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error: " + ex.Message);
        }
        finally
        {
            // Save and close the workbook
            workbook.Save();
            workbook.Close();
            excelApp.Quit();
            
            // Release COM objects to avoid memory leaks
            ReleaseObject(kundenSheet);
            ReleaseObject(workbook);
            ReleaseObject(excelApp);
        }
    }

    private void ReleaseObject(object obj)
    {
        try
        {
            System.Runtime.InteropServices.Marshal.ReleaseComObject(obj);
            obj = null;
        }
        catch (Exception ex)
        {
            obj = null;
            Console.WriteLine("Exception occurred while releasing object: " + ex.ToString());
        }
        finally
        {
            GC.Collect();
        }
    }
}

class Program
{
    static void Main(string[] args)
    {
        ExcelInteropExample example = new ExcelInteropExample();
        example.ProcessKundenSheet("path_to_your_excel_file.xlsx");
    }
}
