using System;
using System.Collections.Generic;
using Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Application excelApp = new Application();
        Workbook workbook = excelApp.Workbooks.Open(@"C:\Path\To\YourFile.xlsx");

        Worksheet worksheet = workbook.Sheets[1];

        // Step 1: Track hidden columns
        List<int> hiddenColumns = TrackHiddenColumns(worksheet);

        // Step 2: Perform your Excel operations here...

        // Step 3: Re-hide the previously hidden columns
        RehideColumns(worksheet, hiddenColumns);

        // Save and close the workbook
        workbook.Save();
        workbook.Close(false);
        excelApp.Quit();
    }

    static List<int> TrackHiddenColumns(Worksheet worksheet)
    {
        List<int> hiddenColumns = new List<int>();
        Range usedRange = worksheet.UsedRange;

        for (int col = 1; col <= usedRange.Columns.Count; col++)
        {
            if (worksheet.Columns[col].EntireColumn.Hidden)
            {
                hiddenColumns.Add(col);
            }
        }

        return hiddenColumns;
    }

    static void RehideColumns(Worksheet worksheet, List<int> hiddenColumns)
    {
        foreach (int col in hiddenColumns)
        {
            worksheet.Columns[col].EntireColumn.Hidden = true;
        }
    }
}
