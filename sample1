using System;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        Excel.Application excelApp = null;
        Excel.Workbook sourceWorkbook = null;
        Excel.Workbook destinationWorkbook = null;

        try
        {
            // Start Excel application
            excelApp = new Excel.Application();
            excelApp.Visible = false; // Set to true for debugging, set to false for production

            // Path to the source Excel file
            string sourceFilePath = @"C:\path\to\your\source_excel_file.xlsx";
            // Path to the destination Excel file
            string destinationFilePath = @"C:\path\to\your\destination_excel_file.xlsx";

            // Open the source Excel file
            sourceWorkbook = excelApp.Workbooks.Open(sourceFilePath);
            Excel.Worksheet sourceWorksheet = sourceWorkbook.Sheets[1]; // Assuming the first worksheet

            // Get the used range of the source worksheet
            Excel.Range usedRange = sourceWorksheet.UsedRange;
            
            // Determine the dimensions of the data range
            int numRows = usedRange.Rows.Count;
            int numCols = usedRange.Columns.Count;

            // Read data from source Excel into the array, excluding the header row
            object[,] data = new object[numRows - 1, numCols];
            for (int row = 2; row <= numRows; row++) // Start from row 2 to exclude header
            {
                for (int col = 1; col <= numCols; col++)
                {
                    data[row - 2, col - 1] = usedRange.Cells[row, col].Value2;
                }
            }

            // Close the source workbook without saving changes
            sourceWorkbook.Close(false);

            // Open the destination Excel file
            destinationWorkbook = excelApp.Workbooks.Open(destinationFilePath);
            Excel.Worksheet destinationWorksheet = destinationWorkbook.Sheets[1]; // Assuming the first worksheet

            // Determine the starting cell for pasting values (A9)
            int startPasteRow = 9; // Row 9 in destination file
            int startPasteCol = 1; // Column A (1st column) in Excel's indexing

            // Get the range to paste values into destination worksheet
            Excel.Range destinationRange = destinationWorksheet.Cells[startPasteRow, startPasteCol];

            // Paste values from the data array to the destination range
            destinationRange.Resize[numRows - 1, numCols].Value = data;

            // Save and close the destination workbook
            destinationWorkbook.Save();
            destinationWorkbook.Close();

            Console.WriteLine("Data copied and pasted successfully.");
        }
        catch (Exception ex)
        {
            Console.WriteLine("An error occurred: " + ex.Message);
        }
        finally
        {
            // Quit Excel application
            if (excelApp != null)
            {
                excelApp.Quit();
                System.Runtime.InteropServices.Marshal.ReleaseComObject(excelApp);
            }
        }
    }
}
