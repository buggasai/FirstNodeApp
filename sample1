using System;
using System.Runtime.InteropServices;
using Excel = Microsoft.Office.Interop.Excel;

class Program
{
    static void Main()
    {
        // Create a new Excel application
        Excel.Application excelApp = new Excel.Application();

        // Make the application visible (optional for demonstration)
        excelApp.Visible = true;

        // Define the path to the workbook
        string filePath = @"C:\path\to\your\file.xlsx";

        // Open the workbook
        Excel.Workbook workbook = excelApp.Workbooks.Open(filePath);

        // Access the worksheet from which you want to get the row count
        Excel.Worksheet dataWorksheet = (Excel.Worksheet)workbook.Sheets["DataSheet"]; // Replace "DataSheet" with the name of your sheet

        // Find the last row with data in column A (or any specific column)
        int lastRow = dataWorksheet.Cells[dataWorksheet.Rows.Count, 1].End(Excel.XlDirection.xlUp).Row;

        // Output the last row number
        Console.WriteLine($"The last row with data in the 'DataSheet' is: {lastRow}");

        // Clean up
        workbook.Close(false);
        excelApp.Quit();

        Marshal.ReleaseComObject(dataWorksheet);
        Marshal.ReleaseComObject(workbook);
        Marshal.ReleaseComObject(excelApp);

        GC.Collect();
        GC.WaitForPendingFinalizers();
    }
}
